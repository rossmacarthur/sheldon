language: rust
services: docker
sudo: required

env:
  global:
    - CRATE=sheldon

matrix:
  include:
    - dist: xenial
      rust: stable
      env: TARGET=x86_64-unknown-linux-gnu LINT=true PUBLISH=true
    - dist: xenial
      rust: beta
      env: TARGET=x86_64-unknown-linux-gnu LINT=true
    - dist: xenial
      rust: nightly
      env: TARGET=x86_64-unknown-linux-gnu LINT=true
    - os: osx
      rust: stable
      env: TARGET=x86_64-apple-darwin LINT=true
    - os: osx
      rust: beta
      env: TARGET=x86_64-apple-darwin LINT=true
    - os: osx
      rust: nightly
      env: TARGET=x86_64-apple-darwin LINT=true
    - dist: trusty
      rust: stable
      env: TARGET=x86_64-unknown-linux-musl
    - dist: trusty
      rust: stable
      env: TARGET=armv7-unknown-linux-gnueabihf
    - dist: trusty
      rust: stable
      env: TARGET=armv7-unknown-linux-musleabihf
  fast_finish: true
  allow_failures:
    - rust: nightly
      env: TARGET=x86_64-unknown-linux-gnu LINT=true
    - rust: nightly
      env: TARGET=x86_64-apple-darwin LINT=true

install:
  - bash ci/install.sh

script:
  - bash ci/script.sh

before_deploy:
  - bash ci/before_deploy.sh

deploy:
  # Publish to GitHub releases
  - provider: releases
    skip_cleanup: true
    on:
      condition: "$TRAVIS_RUST_VERSION = stable"
      tags: true
    api_key:
      secure: VjnzZl3Vbf+qPAfv+JM0CrMg7fEXL0nSas691qMiQxHbOgk0xO6mguW6LOOMIuQSYfrBa62AcvaaA/1QozeR6ADft0h4OfVTMxe5iYKMe+HaMSLN6VQ/GkmjB2Qlco0IHK+wrD/m2zQWNIoTNavfwx6DECUhta1WSYlpXyECsXi/nr5FeNCUuX4eD6BOVPpqpzDeWMmgAXaAoPJqbkTdW0OqvAeLfqmzsdAkMefTwOJIzAPtVR7vMZk7APXQcOlAzIH2E1e7jD2Vj/heMkqPtHs8QFbZGe71TnzS1SlVLkOU8ZHw8YRtY5MCUlt1mMcWV9ye2AHaiWsDNBhgn21oOBMKGIex92g36vyxDG2SGCOL+DCnxWTVnUOg2ZzIfoMyvHJNpGwLY7GZ1Z07vgzVlxZRyp8qF2OrqDbthtvL62afZjAFMBlEKftW1rQKCQ9QEfYSUmwn5vUFklwcVHYHuiVGb2m6z3ChOITqcmJWH/KiZPu8U9E+6dQ8zNYKi9mk+Eouvxw4jv/IjIFOEcX8zVmpXQ+2NIyoUUp7EEHsvY6D159bCkGdAsB7wu6XXFvP+GuJlQDtrCKVXXXHL3dqPR4lW+s74yyzyrsGvxh4oT3ucsp7c2E3DOk+mYGkUxCBbDFXi5y6ysqQjqhi9caHhGg547RsDbTV69N1yX577mI=
    file: "$CRATE-$TRAVIS_TAG-$TARGET.tar.gz"
  # Publish to crates.io
  - provider: cargo
    on:
      condition: "$PUBLISH = true"
      tags: true
    token:
      secure: G6Gm6LUWonNm1juRJSCfQS4a63BNQFwEG6iaZUGWmWlaaPAzONBHv6lHE6ylVGotyqRM4VHSo0LSZuud7qMlbtzn9LBBARpysCpAfE2XhwkY3hpNd1K2Xd26BUhnYIrBuf+ywSLEFuqwr/sCj7V7VhZxYyUbjrIdPPgRfpCvC4zpWSQkr40aN3tGosn9Rp5lTYJy7fEbHM6eJwmjiSvE6WVMI7HltPsckrAZKR9xx14iOgL84AtuiBYA5ZVSX/scwPmHPrZQpXtJ6Gy/D82LNnd1CaOwpJM2QBsAI5N2jZnslU5jBK3vpHGHfQFs9DjdpnHYvw5tYNsOCsHBaIVWTi37FLkjubE+UrI4FTvqPa8HVyQLZjeQb+To6mVQk21Mompp5WwyG5PugMo9PAgLG+AB/jMEhoFDBYICa9nyCkm/8fi2Nm5TP1GV3n6fqaHKGdoFz97W63uTPHPdgZvW5EATCtNqDoa7BQe2ylpscqlY13GKh/kwDaNxsX0wopndGf4whtBSucuwkCYRHmZOIm62MOOvloz9SAuOt8HNFwNvHHKdHjNfKuo/QjtiP+hIHQWGYXAfh3Nnocg7OnBD9lafTtHp32WfA8EwzBnfNPRO1W5HkrjWbbIIb38/k1EaUg/SiLeYqQDwPYbDb/jIGNA7gTG1icziEef7/MW2Xd0=
